{% extends "index.html" %}
{% load staticfiles %}
{% load add_class %}

{% block scripts %}
    <script src="{% static 'js/script.js' %}"></script>
    <script type="text/javascript">
        $(function() {
            $("#msg").delay(3000).fadeOut(0, function(){
                window.location.href = "/";
            });
        });
    </script>
    <script>
        $(function() {
            $('#change-user').on('click', function(){
                var user_data = {
                    'courses': [document.getElementById('course-name-1').textContent,
                                document.getElementById('course-name-2').textContent,
                                document.getElementById('course-name-3').textContent,
                                document.getElementById('course-name-4').textContent,
                                document.getElementById('course-name-5').textContent,
                    ],
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                };
                $.ajax({
                    type: 'POST',
                    url: "{% url 'ajax_change' user_id %}",
                    data: user_data,
                    success: function() {
                        console.log('success');
                    },
                    error: function(){
                        alert('not succcess!!!')
                    }
                });
            });
        });
    </script>
    
{% endblock %}
{% block main %}
    <div id='courses'>
        <h3>CHANGE USER</h3>
    </div>
    <div class="rules">
        {% block rules %}
            <span class="step-links">
                <a href="{% url 'users'%}" class='back circle w3-button w3-green'>
                    <i class="arrow-back left"></i>
                </a>
            </span>
            {% if message %}
                <div id='msg' class="success">
                    <b><i class="w3-text-green">{{ message }}</i></b>
                </div>
            {% endif %}
        {% endblock %}
    </div>
    <div class="table">
        {% block table %}
            <div class='user-form'>
                <form id='user-form' action="{% url 'change' user_id %}?next=/" method="post" novalidate="novalidate">
                    {% csrf_token %}
                    {% for field in form %}
                        <div class="input-group">
                            {% if field.label == 'Courses'%}
                                <i id='label_course' class='w3-text-black'>
                                    {{ field.label_tag }}
                                </i>
                                <br>
                                {{ field }}
                                <a id='add_btn' href="#" onclick="hide_show()" class='add addcourse w3-button w3-circle w3-green'></a>
                            {% else %}
                                <i class='w3-text-black'>
                                    {{ field.label_tag }}
                                </i>
                                <br>
                                {{ field }}
                            {% endif %}
                            {% if form.errors %}
                                {% for error in field.errors %}
                                <i class="error-message w3-text-red">
                                    <strong>{{ error|escape }}</strong>
                                </i>
                                {% endfor %}
                            {% endif %}
                            {% if field.help_text %}
                            <p class="help">{{ field.help_text|safe }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                    <div id="selected-items" class='selected-items'>
                        {% for item in loop_times %}
                            <div id='selected-item-{{item}}' style='display: none;' class='empty selected-items'>
                                <b id='course-name-{{item}}' class='w3-text-black '></b>
                                <a id='close' onclick="del(this)"></a>
                                <hr class='style1 w3-text-gray'>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="input-group">
                        <input id='change-user' type="submit" value="Save" />
                    </div>
                </form>
            </div>
        {% endblock table %}
    </div>
{% endblock %}
